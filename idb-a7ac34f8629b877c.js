(()=>{"use strict";var e={},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,r),o.exports}r.rv=function(){return"1.2.3"},r.ruid="bundler=rspack@1.2.3";const s=e=>("string"!=typeof e&&console.log(e),e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()),n=e=>e.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");let o;const a=(e,t,r,s)=>new Promise(((n,o)=>{const a=e.transaction(t,r);a.oncomplete=n,a.onerror=o,s(a.objectStore(t))})),c=Promise.all(["undefined"!=typeof window?fetch("/db.json",{cache:"no-cache"}).then((e=>e.json())).catch((()=>null)):Promise.resolve(),new Promise(((e,t)=>{const r=indexedDB.open("app",1);r.onupgradeneeded=e=>{const t=r.result;e.oldVersion||(t.createObjectStore("cards"),t.createObjectStore("abilities"),t.createObjectStore("attacks"))},r.onerror=()=>{console.error("[indexeddb]",r.error),t(r.error)},r.onsuccess=t=>{e(t.target.result)}}))]);c.then((async([e,t])=>{o=t,e&&await a(o,"cards","readwrite",(t=>{for(const r of e)r.search=[r.id,`${r.ext} ${r.extId}`,s(r.fr?.name||""),s(r.en?.name||"")].filter((e=>!!e)).map((e=>e.trim())).join("\n"),t.put(r,r.id)}))}));const i=["F","G","H"];onmessage=async e=>{const t=e.data;if("searchCards"in t){const e=[],r={all:!1,keywords:"",inCardName:!0,inAttackDescs:!1,inAttacksOrAbilities:!0,props:{}};"string"==typeof t.searchCards?r.keywords=t.searchCards:"object"==typeof t.searchCards&&Object.assign(r,t.searchCards);const d=r.keywords?r.keywords.split(/\s+/).map((e=>new RegExp(n(s(e)),"ig"))):[];await(async(e,...t)=>{await c;let r={};"object"==typeof t[1]&&(r=t[1]);const s=t.pop();return a(o,e,r.mode||"readonly",s)})("cards",(t=>{t.openCursor().onsuccess=t=>{const o=t.target.result;if(o){const t=o.value;let a=!1;a||=r.all||i.includes(t.regulationMark);try{if(a){a=!0;for(const e of d){let n=!1;if(n||=r.inCardName&&t.search.match(e),n||=r.inAttacksOrAbilities&&(t.en.attacks.find((t=>s(t.name).match(e)))||t.fr.attacks.find((t=>s(t.name).match(e)))||t.fr.abilities.find((t=>s(t).match(e)))||t.en.abilities.find((t=>s(t).match(e)))),n||=r.inAttackDescs&&(t.en.attacks.find((t=>t.description&&s(t.description).match(e)))||t.fr.attacks.find((t=>t.description&&s(t.description).match(e)))||t.en.description&&s(t.en.description).match(e)||t.fr.description&&s(t.fr.description).match(e)),a&&=n,!a)break}for(const e in r.props){let s=r.props[e];s instanceof RegExp||(s=new RegExp(n(s),"i")),a&&=t[e]&&t[e].toString().match(s)}}}catch(e){console.error("Card had an error",t,e)}a&&e.push(t),o.continue()}}})),postMessage(e)}else postMessage(void 0)}})();